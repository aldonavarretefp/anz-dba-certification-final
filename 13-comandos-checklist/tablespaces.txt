SELECT
    TABLESPACE_NAME,
    COUNT(FILE_NAME) AS Number_Of_Datafiles,
    SUM(BYTES) / 1024 / 1024 AS "Total_Allocated_MB",
    SUM(CASE WHEN AUTOEXTENSIBLE = 'YES' THEN MAXBYTES ELSE BYTES END) / 1024 / 1024 AS "Potential_Max_Size_MB"
FROM
    DBA_DATA_FILES
GROUP BY
    TABLESPACE_NAME
ORDER BY
    TABLESPACE_NAME;



SELECT
  CASE
    WHEN ts.TABLESPACE_NAME LIKE 'TS_CENTROS_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_EMPLEADOS_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_CERTIFICACIONES_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_ACTIVIDADES_%'
    THEN 'MÓDULO 1'
    WHEN ts.TABLESPACE_NAME LIKE 'TS_CLIENTES_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_MEMBRESIAS_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_VISITAS_%'
      OR ts.TABLESPACE_NAME LIKE 'TS_ACTPART_%'
    THEN 'MÓDULO 2'
    ELSE 'OTROS'
  END AS MODULO,

  ts.TABLESPACE_NAME,
  CASE
    WHEN ts.TABLESPACE_NAME LIKE '%_DATA'         THEN 'Tablas'
    WHEN ts.TABLESPACE_NAME LIKE '%_IDX'          THEN 'Índices'
    WHEN ts.TABLESPACE_NAME LIKE '%_BLOB'         THEN 'CLOB/BLOB'
    ELSE 'Otro'
  END AS TIPO_TABLESPACE,

  df.FILE_NAME,
  ROUND(df.BYTES/1024/1024, 2)    AS TAMAÑO_MB,
  df.STATUS                      AS ESTADO_ARCHIVO,
  CASE 
    WHEN df.AUTOEXTENSIBLE = 'YES' THEN 'Sí' 
    ELSE 'No' 
  END                             AS AUTOEXTENSIBLE,
  ROUND(df.MAXBYTES/1024/1024, 2) AS MAX_TAMAÑO_MB
FROM
  DBA_TABLESPACES ts
  JOIN DBA_DATA_FILES df
    ON ts.TABLESPACE_NAME = df.TABLESPACE_NAME
ORDER BY
  MODULO,
  TIPO_TABLESPACE,
  ts.TABLESPACE_NAME,
  df.FILE_NAME;